# HTTPS

При необходимости открыть доступ к `Atsumeru` серверу вне локальной сети, категорически рекомендуется защитить к нему запросы с помощью `https` (особенно ввиду того, что основной способ авторизации - `Basic`)

[Spring Boot](https://spring.io/projects/spring-boot), который является сердцем сервера, поддерживает `https` из коробки, но его необходимо настраивать самому, а self-signed и [Let's Encrypt](https://letsencrypt.org/) сертификаты не поддерживаются

## Reverse Proxy

Оптимальным вариантом является использование [CloudFlare Reverse Proxy](./https.md#cloudflare-reverse-proxy), [CloudFlare Tunnel](./https.md#cloudflare-tunnel) или [Caddy](./https.md#caddy)

:::c-danger
Для любого из указанных методов потребуется наличие собственного доменного имени с возможностью смены `NS-сервера`
:::

### CloudFlare Reverse Proxy

:::c-tip
`HTTPS` сертификат предоставляется бесплатно и автоматически
:::

:::c-danger
Данный метод работает только при наличии статического/белого IP и с портами `80`, `8080` или `443`. Если ваш сервер находится за `NAT` или вы хотите использовать иной порт, воспользуйтесь [CloudFlare Tunnel](./https.md#cloudflare-tunnel)
:::

- Необходимо зарегистрироваться в [CloudFlare](https://dash.cloudflare.com/)
- Нажать на кнопку `Add Site` на панели быстрого доступа
- Следовать инструкции по добавлению и настройке своего домена
- Открыть панель управления доменом
- Перейти в раздел `DNS`
- Настроить редирект на актуальный адрес сервера

:::c-tip
Также, можно (и предпочтительно) включить проксирование запросов для кеширования их в `CloudFlare` и сокрытия реального IP/адреса сервера
:::

### CloudFlare Tunnel

:::c-tip
`HTTPS` сертификат предоставляется бесплатно и автоматически
:::

- Необходимо зарегистрироваться в [CloudFlare Zero Trust](https://one.dash.cloudflare.com/)
- Открыть раздел `Access` 
- Открыть подраздел `Tunnel`
- Нажать на `Create a tunnel` и следовать инструкции по созданию туннеля
- После создания туннеля и активации коннектора, открыть созданный туннель в панели управления
- Во вкладке `Public Hostnames` добавить свой домен с указанием IP/адреса сервера и его порта

:::c-tip
При необходимости, во вкладке `Public Hostnames` можно добавить поддомены для своего домена с указанием иного IP/адреса сервера или порта 
:::

### Caddy

:::c-tip
[Caddy](https://caddyserver.com/) поддерживает автоматическую генерацию [Let's Encrypt](https://letsencrypt.org/) сертификатов
:::

Необходимо установить [Caddy](https://caddyserver.com/)

Примеры конфигурации:

#### Caddy (v2):
```
<свой домен> {
  reverse_proxy http://<ip/адрес сервера>:<порт>
}
```

С HTTPS:
```
{
  ваш@email.com
  http_port 80
  https_port 443
}

<свой домен> {
  reverse_proxy http://<ip/адрес сервера>:<порт> 
}
```