# HTTPS

За необхідності відкрити доступ до `Atsumeru` серверу поза локальною мережею, категорично рекомендується захистити запити до нього за допомогою `https` (особливо з огляду на те, що основний спосіб авторизації - `Basic`)

[Spring Boot](https://spring.io/projects/spring-boot), який є серцем сервера, підтримує `https` з коробки, але його необхідно налаштовувати самому, а self-signed сертифікати не підтримуються (наприклад, [Let's Encrypt](https://letsencrypt.org/))

## Reverse Proxy

Оптимальним варіантом є використання [CloudFlare Reverse Proxy](./https.md#cloudflare-reverse-proxy), [CloudFlare Tunnel](./https.md#cloudflare-tunnel) або [Caddy](./https.md#caddy)

:::c-danger
Для будь-якого із зазначених методів потрібна наявність власного доменного імені з можливістю зміни `NS-сервера`
:::

### CloudFlare Reverse Proxy

:::c-tip
`HTTPS` сертифікат надається безкоштовно та автоматично
:::

:::c-danger
Цей метод працює тільки за наявності статичного/білого IP і з портами `80`, `8080` або `443`. Якщо ваш сервер знаходиться за `NAT` або ви хочете використовувати інший порт, скористайтеся [CloudFlare Tunnel](./https.md#cloudflare-tunnel)
:::

- Необхідно зареєструватися в [CloudFlare](https://dash.cloudflare.com/)
- Натиснути на кнопку `Add Site` на панелі швидкого доступу
- Дотримуватися інструкції з додавання та налаштування свого домену
- Відкрити панель управління доменом
- Перейти в розділ `DNS`
- Налаштувати редирект на актуальну адресу сервера

:::c-tip
Також, можливо (і бажано) увімкнути проксування запитів для кешування їх у `CloudFlare` і приховування реального IP/адреса сервера
:::

### CloudFlare Tunnel

:::c-tip
`HTTPS` сертифікат надається безкоштовно та автоматично
:::

- Необхідно зареєструватися в [CloudFlare Zero Trust](https://one.dash.cloudflare.com/)
- Відкрити розділ `Access` 
- Відкрити підрозділ `Tunnel`
- Натиснути на `Create a tunnel` і слідувати інструкції зі створення тунелю
- Після створення тунелю й активації конектора, відкрити створений тунель в панелі управління
- У вкладці `Public Hostnames` додати свій домен із зазначенням IP/адресу сервера и його порту

:::c-tip
За необхідності, у вкладці `Public Hostnames` можна додати піддомени для свого домену із зазначенням іншого IP/адресу сервера або порта 
:::

### Caddy

:::c-tip
[Caddy](https://caddyserver.com/) підтримує автоматичну генерацію [Let's Encrypt](https://letsencrypt.org/) сертифікатів
:::

Необхідно встановити [Caddy](https://caddyserver.com/)

Приклади конфігурації

#### Caddy (v1):
```
<свій домен> {
  proxy / http://<ip/адрес сервера>:<порт> {
    transparent
  }
}
```

#### Caddy (v2):
```
<свій домен> {
  reverse_proxy http://<ip/адрес сервера>:<порт>
}
```